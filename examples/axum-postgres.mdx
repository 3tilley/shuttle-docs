---
title: "Postgres Todo App"
---

This example shows how to make a simple TODO app using Axum and a shared Shuttle Postgres DB.

The following routes are provided:
```
- GET /todos/<id> - Get a to-do item by ID.
- POST /todos - Create a to-do item. Takes "note" as a JSON body parameter.
```

You can clone the example below by running the following (you'll need `cargo-shuttle` installed):
```bash:
cargo shuttle init --from https://github.com/shuttle-hq/shuttle-examples.git \
 --subfolder axum/postgres
```

<CodeGroup>
```rust src/main.rs
use axum::{Json, 
	extract::{Path, State}, 
	http::StatusCode, 
	response::IntoResponse, 
	Router, 
	routing::get};
use serde::{Deserialize, Serialize};
use shuttle_runtime::CustomError;
use sqlx::{FromRow, PgPool};

async fn retrieve(
	Path(id): Path<i32>, 
	State(state): State<MyState>
	) -> Result<impl IntoResponse, impl IntoResponse> {
    match sqlx::query_as::<_, Todo>("SELECT * FROM todos WHERE id = $1")
        .bind(id)
        .fetch_one(&state.pool)
        .await {
		Ok(todo) => Ok((StatusCode::OK, Json(todo))),
		Err(e) => Err((StatusCode::BAD_REQUEST, e.to_string()))
	}
}

async fn add(
    State(state): State<MyState>,
    Json(data): Json<TodoNew>,
) -> Result<impl IntoResponse, impl IntoResponse> {
    match sqlx::query_as::<_, Todo>(
	"INSERT INTO todos (note) VALUES ($1) RETURNING id, note"
	).bind(&data.note)
        .fetch_one(&state.pool)
        .await {
		Ok(todo) => Ok((StatusCode::CREATED, Json(todo))),
		Err(e) => Err((StatusCode::BAD_REQUEST, e.to_string()))
	}
}

#[derive(Clone)]
struct MyState {
    pool: PgPool,
}

#[shuttle_runtime::main]
async fn axum(
	#[shuttle_shared_db::Postgres] pool: PgPool
	) -> shuttle_axum::ShuttleAxum {
    sqlx::migrate!().run(&pool)
        .await
        .map_err(CustomError::new)?;

    let state = MyState { pool };
    let router = Router::new()
        .route("/todo", get(retrieve).post(add))
        .with_state(state);

    Ok(router.into())
}

#[derive(Deserialize)]
struct TodoNew {
    pub note: String,
}

#[derive(Serialize, FromRow)]
struct Todo {
    pub id: i32,
    pub note: String,
}
```

```sql migrations/schema.sql
DROP TABLE IF EXISTS todos;

CREATE TABLE todos (
  id serial PRIMARY KEY,
  note TEXT NOT NULL
);
```

```toml Cargo.toml
[package]
name = "postgres"
version = "0.1.0"
edition = "2021"

[dependencies]
axum = "0.6.18"
serde = { version = "1.0.148", features = ["derive"] }
shuttle-shared-db = { version = "0.27.0", features = ["postgres"] }
shuttle-axum = "0.27.0"
shuttle-runtime = "0.27.0"
sqlx = { version = "0.7.1", features = ["runtime-tokio-native-tls", "postgres"] }
tokio = "1.26.0"
```
</CodeGroup>
